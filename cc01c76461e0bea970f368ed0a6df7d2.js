ace.define("ace/snippets",["require","exports","module","ace/lib/oop","ace/lib/event_emitter","ace/lib/lang","ace/range","ace/range_list","ace/keyboard/hash_handler","ace/tokenizer","ace/clipboard","ace/lib/dom","ace/editor"],function(S,m,B){"use strict";var F=S("./lib/oop"),H=S("./lib/event_emitter").EventEmitter,N=S("./lib/lang"),A=S("./range").Range,y=S("./range_list").RangeList,_=S("./keyboard/hash_handler").HashHandler,w=S("./tokenizer").Tokenizer,R=S("./clipboard"),$={CURRENT_WORD:function(e){return e.session.getTextRange(e.session.getWordRange())},SELECTION:function(e,t,r){var i=e.session.getTextRange();return r?i.replace(/\n\r?([ \t]*\S)/g,`
`+r+"$1"):i},CURRENT_LINE:function(e){return e.session.getLine(e.getCursorPosition().row)},PREV_LINE:function(e){return e.session.getLine(e.getCursorPosition().row-1)},LINE_INDEX:function(e){return e.getCursorPosition().row},LINE_NUMBER:function(e){return e.getCursorPosition().row+1},SOFT_TABS:function(e){return e.session.getUseSoftTabs()?"YES":"NO"},TAB_SIZE:function(e){return e.session.getTabSize()},CLIPBOARD:function(e){return R.getText&&R.getText()},FILENAME:function(e){return/[^/\\]*$/.exec(this.FILEPATH(e))[0]},FILENAME_BASE:function(e){return/[^/\\]*$/.exec(this.FILEPATH(e))[0].replace(/\.[^.]*$/,"")},DIRECTORY:function(e){return this.FILEPATH(e).replace(/[^/\\]*$/,"")},FILEPATH:function(e){return"/not implemented.txt"},WORKSPACE_NAME:function(){return"Unknown"},FULLNAME:function(){return"Unknown"},BLOCK_COMMENT_START:function(e){var t=e.session.$mode||{};return t.blockComment&&t.blockComment.start||""},BLOCK_COMMENT_END:function(e){var t=e.session.$mode||{};return t.blockComment&&t.blockComment.end||""},LINE_COMMENT:function(e){var t=e.session.$mode||{};return t.lineCommentStart||""},CURRENT_YEAR:T.bind(null,{year:"numeric"}),CURRENT_YEAR_SHORT:T.bind(null,{year:"2-digit"}),CURRENT_MONTH:T.bind(null,{month:"numeric"}),CURRENT_MONTH_NAME:T.bind(null,{month:"long"}),CURRENT_MONTH_NAME_SHORT:T.bind(null,{month:"short"}),CURRENT_DATE:T.bind(null,{day:"2-digit"}),CURRENT_DAY_NAME:T.bind(null,{weekday:"long"}),CURRENT_DAY_NAME_SHORT:T.bind(null,{weekday:"short"}),CURRENT_HOUR:T.bind(null,{hour:"2-digit",hour12:!1}),CURRENT_MINUTE:T.bind(null,{minute:"2-digit"}),CURRENT_SECOND:T.bind(null,{second:"2-digit"})};$.SELECTED_TEXT=$.SELECTION;function T(e){var t=new Date().toLocaleString("en-us",e);return t.length==1?"0"+t:t}var M=function(){this.snippetMap={},this.snippetNameMap={}};(function(){F.implement(this,H),this.getTokenizer=function(){return M.$tokenizer||this.createTokenizer()},this.createTokenizer=function(){function e(i){return i=i.substr(1),/^\d+$/.test(i)?[{tabstopId:parseInt(i,10)}]:[{text:i}]}function t(i){return"(?:[^\\\\"+i+"]|\\\\.)"}var r={regex:"/("+t("/")+"+)/",onMatch:function(i,s,o){var n=o[0];return n.fmtString=!0,n.guard=i.slice(1,-1),n.flag="",""},next:"formatString"};return M.$tokenizer=new w({start:[{regex:/\\./,onMatch:function(i,s,o){var n=i[1];return(n=="}"&&o.length||"`$\\".indexOf(n)!=-1)&&(i=n),[i]}},{regex:/}/,onMatch:function(i,s,o){return[o.length?o.shift():i]}},{regex:/\$(?:\d+|\w+)/,onMatch:e},{regex:/\$\{[\dA-Z_a-z]+/,onMatch:function(i,s,o){var n=e(i.substr(1));return o.unshift(n[0]),n},next:"snippetVar"},{regex:/\n/,token:"newline",merge:!1}],snippetVar:[{regex:"\\|"+t("\\|")+"*\\|",onMatch:function(i,s,o){var n=i.slice(1,-1).replace(/\\[,|\\]|,/g,function(f){return f.length==2?f[1]:"\0"}).split("\0").map(function(f){return{value:f}});return o[0].choices=n,[n[0]]},next:"start"},r,{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"start"}],formatString:[{regex:/:/,onMatch:function(i,s,o){return o.length&&o[0].expectElse?(o[0].expectElse=!1,o[0].ifEnd={elseEnd:o[0]},[o[0].ifEnd]):":"}},{regex:/\\./,onMatch:function(i,s,o){var n=i[1];return n=="}"&&o.length||"`$\\".indexOf(n)!=-1?i=n:n=="n"?i=`
`:n=="t"?i="	":"ulULE".indexOf(n)!=-1&&(i={changeCase:n,local:n>"a"}),[i]}},{regex:"/\\w*}",onMatch:function(i,s,o){var n=o.shift();return n&&(n.flag=i.slice(1,-1)),this.next=n&&n.tabstopId?"start":"",[n||i]},next:"start"},{regex:/\$(?:\d+|\w+)/,onMatch:function(i,s,o){return[{text:i.slice(1)}]}},{regex:/\${\w+/,onMatch:function(i,s,o){var n={text:i.slice(2)};return o.unshift(n),[n]},next:"formatStringVar"},{regex:/\n/,token:"newline",merge:!1},{regex:/}/,onMatch:function(i,s,o){var n=o.shift();return this.next=n&&n.tabstopId?"start":"",[n||i]},next:"start"}],formatStringVar:[{regex:/:\/\w+}/,onMatch:function(i,s,o){var n=o[0];return n.formatFunction=i.slice(2,-1),[o.shift()]},next:"formatString"},r,{regex:/:[\?\-+]?/,onMatch:function(i,s,o){i[1]=="+"&&(o[0].ifEnd=o[0]),i[1]=="?"&&(o[0].expectElse=!0)},next:"formatString"},{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"formatString"}]}),M.$tokenizer},this.tokenizeTmSnippet=function(e,t){return this.getTokenizer().getLineTokens(e,t).tokens.map(function(r){return r.value||r})},this.getVariableValue=function(e,t,r){if(/^\d+$/.test(t))return(this.variables.__||{})[t]||"";if(/^[A-Z]\d+$/.test(t))return(this.variables[t[0]+"__"]||{})[t.substr(1)]||"";if(t=t.replace(/^TM_/,""),!this.variables.hasOwnProperty(t))return"";var i=this.variables[t];return typeof i=="function"&&(i=this.variables[t](e,t,r)),i==null?"":i},this.variables=$,this.tmStrFormat=function(e,t,r){if(!t.fmt)return e;var i=t.flag||"",s=t.guard;s=new RegExp(s,i.replace(/[^gim]/g,""));var o=typeof t.fmt=="string"?this.tokenizeTmSnippet(t.fmt,"formatString"):t.fmt,n=this,f=e.replace(s,function(){var a=n.variables.__;n.variables.__=[].slice.call(arguments);for(var h=n.resolveVariables(o,r),u="E",g=0;g<h.length;g++){var v=h[g];if(typeof v=="object")if(h[g]="",v.changeCase&&v.local){var b=h[g+1];b&&typeof b=="string"&&(v.changeCase=="u"?h[g]=b[0].toUpperCase():h[g]=b[0].toLowerCase(),h[g+1]=b.substr(1))}else v.changeCase&&(u=v.changeCase);else u=="U"?h[g]=v.toUpperCase():u=="L"&&(h[g]=v.toLowerCase())}return n.variables.__=a,h.join("")});return f},this.tmFormatFunction=function(e,t,r){return t.formatFunction=="upcase"?e.toUpperCase():t.formatFunction=="downcase"?e.toLowerCase():e},this.resolveVariables=function(e,t){for(var r=[],i="",s=!0,o=0;o<e.length;o++){var n=e[o];if(typeof n=="string"){r.push(n),n==`
`?(s=!0,i=""):s&&(i=/^\t*/.exec(n)[0],s=/\S/.test(n));continue}if(!!n){if(s=!1,n.fmtString){var f=e.indexOf(n,o+1);f==-1&&(f=e.length),n.fmt=e.slice(o+1,f),o=f}if(n.text){var a=this.getVariableValue(t,n.text,i)+"";n.fmtString&&(a=this.tmStrFormat(a,n,t)),n.formatFunction&&(a=this.tmFormatFunction(a,n,t)),a&&!n.ifEnd?(r.push(a),h(n)):!a&&n.ifEnd&&h(n.ifEnd)}else n.elseEnd?h(n.elseEnd):(n.tabstopId!=null||n.changeCase!=null)&&r.push(n)}}function h(u){var g=e.indexOf(u,o+1);g!=-1&&(o=g)}return r},this.insertSnippetForSelection=function(e,t){var r=e.getCursorPosition(),i=e.session.getLine(r.row),s=e.session.getTabString(),o=i.match(/^\s*/)[0];r.column<o.length&&(o=o.slice(0,r.column)),t=t.replace(/\r/g,"");var n=this.tokenizeTmSnippet(t);n=this.resolveVariables(n,e),n=n.map(function(d){return d==`
`?d+o:typeof d=="string"?d.replace(/\t/g,s):d});var f=[];n.forEach(function(d,E){if(typeof d=="object"){var C=d.tabstopId,x=f[C];if(x||(x=f[C]=[],x.index=C,x.value="",x.parents={}),x.indexOf(d)===-1){d.choices&&!x.choices&&(x.choices=d.choices),x.push(d);var I=n.indexOf(d,E+1);if(I!==-1){var P=n.slice(E+1,I),W=P.some(function(Z){return typeof Z=="object"});W&&!x.value?x.value=P:P.length&&(!x.value||typeof x.value!="string")&&(x.value=P.join(""))}}}}),f.forEach(function(d){d.length=0});var a={};function h(d){for(var E=[],C=0;C<d.length;C++){var x=d[C];if(typeof x=="object"){if(a[x.tabstopId])continue;var I=d.lastIndexOf(x,C-1);x=E[I]||{tabstopId:x.tabstopId}}E[C]=x}return E}for(var u=0;u<n.length;u++){var g=n[u];if(typeof g=="object"){var v=g.tabstopId,b=f[v],j=n.indexOf(g,u+1);if(a[v]){a[v]===g&&(delete a[v],Object.keys(a).forEach(function(d){b.parents[d]=!0}));continue}a[v]=g;var k=b.value;typeof k!="string"?k=h(k):g.fmt&&(k=this.tmStrFormat(k,g,e)),n.splice.apply(n,[u+1,Math.max(0,j-u)].concat(k,g)),b.indexOf(g)===-1&&b.push(g)}}var U=0,O=0,V="";n.forEach(function(d){if(typeof d=="string"){var E=d.split(`
`);E.length>1?(O=E[E.length-1].length,U+=E.length-1):O+=d.length,V+=d}else d&&(d.start?d.end={row:U,column:O}:d.start={row:U,column:O})});var z=e.getSelectionRange(),D=e.session.replace(z,V),K=new L(e),Y=e.inVirtualSelectionMode&&e.selection.index;K.addTabstops(f,z.start,D,Y)},this.insertSnippet=function(e,t){var r=this;if(e.inVirtualSelectionMode)return r.insertSnippetForSelection(e,t);e.forEachSelection(function(){r.insertSnippetForSelection(e,t)},null,{keepOrder:!0}),e.tabstopManager&&e.tabstopManager.tabNext()},this.$getScope=function(e){var t=e.session.$mode.$id||"";if(t=t.split("/").pop(),t==="html"||t==="php"){t==="php"&&!e.session.$mode.inlinePhp&&(t="html");var r=e.getCursorPosition(),i=e.session.getState(r.row);typeof i=="object"&&(i=i[0]),i.substring&&(i.substring(0,3)=="js-"?t="javascript":i.substring(0,4)=="css-"?t="css":i.substring(0,4)=="php-"&&(t="php"))}return t},this.getActiveScopes=function(e){var t=this.$getScope(e),r=[t],i=this.snippetMap;return i[t]&&i[t].includeScopes&&r.push.apply(r,i[t].includeScopes),r.push("_"),r},this.expandWithTab=function(e,t){var r=this,i=e.forEachSelection(function(){return r.expandSnippetForSelection(e,t)},null,{keepOrder:!0});return i&&e.tabstopManager&&e.tabstopManager.tabNext(),i},this.expandSnippetForSelection=function(e,t){var r=e.getCursorPosition(),i=e.session.getLine(r.row),s=i.substring(0,r.column),o=i.substr(r.column),n=this.snippetMap,f;return this.getActiveScopes(e).some(function(a){var h=n[a];return h&&(f=this.findMatchingSnippet(h,s,o)),!!f},this),f?(t&&t.dryRun||(e.session.doc.removeInLine(r.row,r.column-f.replaceBefore.length,r.column+f.replaceAfter.length),this.variables.M__=f.matchBefore,this.variables.T__=f.matchAfter,this.insertSnippetForSelection(e,f.content),this.variables.M__=this.variables.T__=null),!0):!1},this.findMatchingSnippet=function(e,t,r){for(var i=e.length;i--;){var s=e[i];if(!(s.startRe&&!s.startRe.test(t))&&!(s.endRe&&!s.endRe.test(r))&&!(!s.startRe&&!s.endRe))return s.matchBefore=s.startRe?s.startRe.exec(t):[""],s.matchAfter=s.endRe?s.endRe.exec(r):[""],s.replaceBefore=s.triggerRe?s.triggerRe.exec(t)[0]:"",s.replaceAfter=s.endTriggerRe?s.endTriggerRe.exec(r)[0]:"",s}},this.snippetMap={},this.snippetNameMap={},this.register=function(e,t){var r=this.snippetMap,i=this.snippetNameMap,s=this;e||(e=[]);function o(a){return a&&!/^\^?\(.*\)\$?$|^\\b$/.test(a)&&(a="(?:"+a+")"),a||""}function n(a,h,u){return a=o(a),h=o(h),u?(a=h+a,a&&a[a.length-1]!="$"&&(a=a+"$")):(a=a+h,a&&a[0]!="^"&&(a="^"+a)),new RegExp(a)}function f(a){a.scope||(a.scope=t||"_"),t=a.scope,r[t]||(r[t]=[],i[t]={});var h=i[t];if(a.name){var u=h[a.name];u&&s.unregister(u),h[a.name]=a}r[t].push(a),a.prefix&&(a.tabTrigger=a.prefix),!a.content&&a.body&&(a.content=Array.isArray(a.body)?a.body.join(`
`):a.body),a.tabTrigger&&!a.trigger&&(!a.guard&&/^\w/.test(a.tabTrigger)&&(a.guard="\\b"),a.trigger=N.escapeRegExp(a.tabTrigger)),!(!a.trigger&&!a.guard&&!a.endTrigger&&!a.endGuard)&&(a.startRe=n(a.trigger,a.guard,!0),a.triggerRe=new RegExp(a.trigger),a.endRe=n(a.endTrigger,a.endGuard,!0),a.endTriggerRe=new RegExp(a.endTrigger))}Array.isArray(e)?e.forEach(f):Object.keys(e).forEach(function(a){f(e[a])}),this._signal("registerSnippets",{scope:t})},this.unregister=function(e,t){var r=this.snippetMap,i=this.snippetNameMap;function s(o){var n=i[o.scope||t];if(n&&n[o.name]){delete n[o.name];var f=r[o.scope||t],a=f&&f.indexOf(o);a>=0&&f.splice(a,1)}}e.content?s(e):Array.isArray(e)&&e.forEach(s)},this.parseSnippetFile=function(e){e=e.replace(/\r/g,"");for(var t=[],r={},i=/^#.*|^({[\s\S]*})\s*$|^(\S+) (.*)$|^((?:\n*\t.*)+)/gm,s;s=i.exec(e);){if(s[1])try{r=JSON.parse(s[1]),t.push(r)}catch(a){}if(s[4])r.content=s[4].replace(/^\t/gm,""),t.push(r),r={};else{var o=s[2],n=s[3];if(o=="regex"){var f=/\/((?:[^\/\\]|\\.)*)|$/g;r.guard=f.exec(n)[1],r.trigger=f.exec(n)[1],r.endTrigger=f.exec(n)[1],r.endGuard=f.exec(n)[1]}else o=="snippet"?(r.tabTrigger=n.match(/^\S*/)[0],r.name||(r.name=n)):o&&(r[o]=n)}}return t},this.getSnippetByName=function(e,t){var r=this.snippetNameMap,i;return this.getActiveScopes(t).some(function(s){var o=r[s];return o&&(i=o[e]),!!i},this),i}}).call(M.prototype);var L=function(e){if(e.tabstopManager)return e.tabstopManager;e.tabstopManager=this,this.$onChange=this.onChange.bind(this),this.$onChangeSelection=N.delayedCall(this.onChangeSelection.bind(this)).schedule,this.$onChangeSession=this.onChangeSession.bind(this),this.$onAfterExec=this.onAfterExec.bind(this),this.attach(e)};(function(){this.attach=function(e){this.index=0,this.ranges=[],this.tabstops=[],this.$openTabstops=null,this.selectedTabstop=null,this.editor=e,this.editor.on("change",this.$onChange),this.editor.on("changeSelection",this.$onChangeSelection),this.editor.on("changeSession",this.$onChangeSession),this.editor.commands.on("afterExec",this.$onAfterExec),this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)},this.detach=function(){this.tabstops.forEach(this.removeTabstopMarkers,this),this.ranges=null,this.tabstops=null,this.selectedTabstop=null,this.editor.removeListener("change",this.$onChange),this.editor.removeListener("changeSelection",this.$onChangeSelection),this.editor.removeListener("changeSession",this.$onChangeSession),this.editor.commands.removeListener("afterExec",this.$onAfterExec),this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.tabstopManager=null,this.editor=null},this.onChange=function(e){for(var t=e.action[0]=="r",r=this.selectedTabstop||{},i=r.parents||{},s=(this.tabstops||[]).slice(),o=0;o<s.length;o++){var n=s[o],f=n==r||i[n.index];if(n.rangeList.$bias=f?0:1,e.action=="remove"&&n!==r){var a=n.parents&&n.parents[r.index],h=n.rangeList.pointIndex(e.start,a);h=h<0?-h-1:h+1;var u=n.rangeList.pointIndex(e.end,a);u=u<0?-u-1:u-1;for(var g=n.rangeList.ranges.slice(h,u),v=0;v<g.length;v++)this.removeRange(g[v])}n.rangeList.$onChange(e)}var b=this.editor.session;!this.$inChange&&t&&b.getLength()==1&&!b.getValue()&&this.detach()},this.updateLinkedFields=function(){var e=this.selectedTabstop;if(!(!e||!e.hasLinkedRanges||!e.firstNonLinked)){this.$inChange=!0;for(var t=this.editor.session,r=t.getTextRange(e.firstNonLinked),i=0;i<e.length;i++){var s=e[i];if(!!s.linked){var o=s.original,n=m.snippetManager.tmStrFormat(r,o,this.editor);t.replace(s,n)}}this.$inChange=!1}},this.onAfterExec=function(e){e.command&&!e.command.readOnly&&this.updateLinkedFields()},this.onChangeSelection=function(){if(!!this.editor){for(var e=this.editor.selection.lead,t=this.editor.selection.anchor,r=this.editor.selection.isEmpty(),i=0;i<this.ranges.length;i++)if(!this.ranges[i].linked){var s=this.ranges[i].contains(e.row,e.column),o=r||this.ranges[i].contains(t.row,t.column);if(s&&o)return}this.detach()}},this.onChangeSession=function(){this.detach()},this.tabNext=function(e){var t=this.tabstops.length,r=this.index+(e||1);r=Math.min(Math.max(r,1),t),r==t&&(r=0),this.selectTabstop(r),r===0&&this.detach()},this.selectTabstop=function(e){this.$openTabstops=null;var t=this.tabstops[this.index];if(t&&this.addTabstopMarkers(t),this.index=e,t=this.tabstops[this.index],!(!t||!t.length)){this.selectedTabstop=t;var r=t.firstNonLinked||t;if(t.choices&&(r.cursor=r.start),this.editor.inVirtualSelectionMode)this.editor.selection.fromOrientedRange(r);else{var i=this.editor.multiSelect;i.toSingleRange(r);for(var s=0;s<t.length;s++)t.hasLinkedRanges&&t[s].linked||i.addRange(t[s].clone(),!0)}this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler),this.selectedTabstop&&this.selectedTabstop.choices&&this.editor.execCommand("startAutocomplete",{matches:this.selectedTabstop.choices})}},this.addTabstops=function(e,t,r){var i=this.useLink||!this.editor.getOption("enableMultiselect");if(this.$openTabstops||(this.$openTabstops=[]),!e[0]){var s=A.fromPoints(r,r);l(s.start,t),l(s.end,t),e[0]=[s],e[0].index=0}var o=this.index,n=[o+1,0],f=this.ranges;e.forEach(function(a,h){for(var u=this.$openTabstops[h]||a,g=0;g<a.length;g++){var v=a[g],b=A.fromPoints(v.start,v.end||v.start);c(b.start,t),c(b.end,t),b.original=v,b.tabstop=u,f.push(b),u!=a?u.unshift(b):u[g]=b,v.fmtString||u.firstNonLinked&&i?(b.linked=!0,u.hasLinkedRanges=!0):u.firstNonLinked||(u.firstNonLinked=b)}u.firstNonLinked||(u.hasLinkedRanges=!1),u===a&&(n.push(u),this.$openTabstops[h]=u),this.addTabstopMarkers(u),u.rangeList=u.rangeList||new y,u.rangeList.$bias=0,u.rangeList.addList(u)},this),n.length>2&&(this.tabstops.length&&n.push(n.splice(2,1)[0]),this.tabstops.splice.apply(this.tabstops,n))},this.addTabstopMarkers=function(e){var t=this.editor.session;e.forEach(function(r){r.markerId||(r.markerId=t.addMarker(r,"ace_snippet-marker","text"))})},this.removeTabstopMarkers=function(e){var t=this.editor.session;e.forEach(function(r){t.removeMarker(r.markerId),r.markerId=null})},this.removeRange=function(e){var t=e.tabstop.indexOf(e);t!=-1&&e.tabstop.splice(t,1),t=this.ranges.indexOf(e),t!=-1&&this.ranges.splice(t,1),t=e.tabstop.rangeList.ranges.indexOf(e),t!=-1&&e.tabstop.splice(t,1),this.editor.session.removeMarker(e.markerId),e.tabstop.length||(t=this.tabstops.indexOf(e.tabstop),t!=-1&&this.tabstops.splice(t,1),this.tabstops.length||this.detach())},this.keyboardHandler=new _,this.keyboardHandler.bindKeys({Tab:function(e){m.snippetManager&&m.snippetManager.expandWithTab(e)||(e.tabstopManager.tabNext(1),e.renderer.scrollCursorIntoView())},"Shift-Tab":function(e){e.tabstopManager.tabNext(-1),e.renderer.scrollCursorIntoView()},Esc:function(e){e.tabstopManager.detach()}})}).call(L.prototype);var c=function(e,t){e.row==0&&(e.column+=t.column),e.row+=t.row},l=function(e,t){e.row==t.row&&(e.column-=t.column),e.row-=t.row};S("./lib/dom").importCssString(".ace_snippet-marker {    -moz-box-sizing: border-box;    box-sizing: border-box;    background: rgba(194, 193, 208, 0.09);    border: 1px dotted rgba(211, 208, 235, 0.62);    position: absolute;}"),m.snippetManager=new M;var p=S("./editor").Editor;(function(){this.insertSnippet=function(e,t){return m.snippetManager.insertSnippet(this,e,t)},this.expandSnippet=function(e){return m.snippetManager.expandWithTab(this,e)}}).call(p.prototype)}),ace.define("ace/ext/emmet",["require","exports","module","ace/keyboard/hash_handler","ace/editor","ace/snippets","ace/range","ace/config","resources","resources","tabStops","resources","utils","actions"],function(S,m,B){"use strict";var F=S("../keyboard/hash_handler").HashHandler,H=S("../editor").Editor,N=S("../snippets").snippetManager,A=S("../range").Range,y=S("../config"),_,w;function R(){}R.prototype={setupContext:function(c){this.ace=c,this.indentation=c.session.getTabString(),_||(_=window.emmet);var l=_.resources||_.require("resources");l.setVariable("indentation",this.indentation),this.$syntax=null,this.$syntax=this.getSyntax()},getSelectionRange:function(){var c=this.ace.getSelectionRange(),l=this.ace.session.doc;return{start:l.positionToIndex(c.start),end:l.positionToIndex(c.end)}},createSelection:function(c,l){var p=this.ace.session.doc;this.ace.selection.setRange({start:p.indexToPosition(c),end:p.indexToPosition(l)})},getCurrentLineRange:function(){var c=this.ace,l=c.getCursorPosition().row,p=c.session.getLine(l).length,e=c.session.doc.positionToIndex({row:l,column:0});return{start:e,end:e+p}},getCaretPos:function(){var c=this.ace.getCursorPosition();return this.ace.session.doc.positionToIndex(c)},setCaretPos:function(c){var l=this.ace.session.doc.indexToPosition(c);this.ace.selection.moveToPosition(l)},getCurrentLine:function(){var c=this.ace.getCursorPosition().row;return this.ace.session.getLine(c)},replaceContent:function(c,l,p,e){p==null&&(p=l==null?this.getContent().length:l),l==null&&(l=0);var t=this.ace,r=t.session.doc,i=A.fromPoints(r.indexToPosition(l),r.indexToPosition(p));t.session.remove(i),i.end=i.start,c=this.$updateTabstops(c),N.insertSnippet(t,c)},getContent:function(){return this.ace.getValue()},getSyntax:function(){if(this.$syntax)return this.$syntax;var c=this.ace.session.$modeId.split("/").pop();if(c=="html"||c=="php"){var l=this.ace.getCursorPosition(),p=this.ace.session.getState(l.row);typeof p!="string"&&(p=p[0]),p&&(p=p.split("-"),p.length>1?c=p[0]:c=="php"&&(c="html"))}return c},getProfileName:function(){var c=_.resources||_.require("resources");switch(this.getSyntax()){case"css":return"css";case"xml":case"xsl":return"xml";case"html":var l=c.getVariable("profile");return l||(l=this.ace.session.getLines(0,2).join("").search(/<!DOCTYPE[^>]+XHTML/i)!=-1?"xhtml":"html"),l;default:var p=this.ace.session.$mode;return p.emmetConfig&&p.emmetConfig.profile||"xhtml"}},prompt:function(c){return prompt(c)},getSelection:function(){return this.ace.session.getTextRange()},getFilePath:function(){return""},$updateTabstops:function(c){var l=1e3,p=0,e=null,t=_.tabStops||_.require("tabStops"),r=_.resources||_.require("resources"),i=r.getVocabulary("user"),s={tabstop:function(n){var f=parseInt(n.group,10),a=f===0;a?f=++p:f+=l;var h=n.placeholder;h&&(h=t.processText(h,s));var u="${"+f+(h?":"+h:"")+"}";return a&&(e=[n.start,u]),u},escape:function(n){return n=="$"?"\\$":n=="\\"?"\\\\":n}};if(c=t.processText(c,s),i.variables.insert_final_tabstop&&!/\$\{0\}$/.test(c))c+="${0}";else if(e){var o=_.utils?_.utils.common:_.require("utils");c=o.replaceSubstring(c,"${0}",e[0],e[1])}return c}};var $={expand_abbreviation:{mac:"ctrl+alt+e",win:"alt+e"},match_pair_outward:{mac:"ctrl+d",win:"ctrl+,"},match_pair_inward:{mac:"ctrl+j",win:"ctrl+shift+0"},matching_pair:{mac:"ctrl+alt+j",win:"alt+j"},next_edit_point:"alt+right",prev_edit_point:"alt+left",toggle_comment:{mac:"command+/",win:"ctrl+/"},split_join_tag:{mac:"shift+command+'",win:"shift+ctrl+`"},remove_tag:{mac:"command+'",win:"shift+ctrl+;"},evaluate_math_expression:{mac:"shift+command+y",win:"shift+ctrl+y"},increment_number_by_1:"ctrl+up",decrement_number_by_1:"ctrl+down",increment_number_by_01:"alt+up",decrement_number_by_01:"alt+down",increment_number_by_10:{mac:"alt+command+up",win:"shift+alt+up"},decrement_number_by_10:{mac:"alt+command+down",win:"shift+alt+down"},select_next_item:{mac:"shift+command+.",win:"shift+ctrl+."},select_previous_item:{mac:"shift+command+,",win:"shift+ctrl+,"},reflect_css_value:{mac:"shift+command+r",win:"shift+ctrl+r"},encode_decode_data_url:{mac:"shift+ctrl+d",win:"ctrl+'"},expand_abbreviation_with_tab:"Tab",wrap_with_abbreviation:{mac:"shift+ctrl+a",win:"shift+ctrl+a"}},T=new R;m.commands=new F,m.runEmmetCommand=function c(l){if(this.action=="expand_abbreviation_with_tab"){if(!l.selection.isEmpty())return!1;var p=l.selection.lead,e=l.session.getTokenAt(p.row,p.column);if(e&&/\btag\b/.test(e.type))return!1}try{T.setupContext(l);var t=_.actions||_.require("actions");if(this.action=="wrap_with_abbreviation")return setTimeout(function(){t.run("wrap_with_abbreviation",T)},0);var r=t.run(this.action,T)}catch(s){if(!_){var i=m.load(c.bind(this,l));return this.action=="expand_abbreviation_with_tab"?!1:i}l._signal("changeStatus",typeof s=="string"?s:s.message),y.warn(s),r=!1}return r};for(var M in $)m.commands.addCommand({name:"emmet:"+M,action:M,bindKey:$[M],exec:m.runEmmetCommand,multiSelectAction:"forEach"});m.updateCommands=function(c,l){l?c.keyBinding.addKeyboardHandler(m.commands):c.keyBinding.removeKeyboardHandler(m.commands)},m.isSupportedMode=function(c){if(!c)return!1;if(c.emmetConfig)return!0;var l=c.$id||c;return/css|less|scss|sass|stylus|html|php|twig|ejs|handlebars/.test(l)},m.isAvailable=function(c,l){if(/(evaluate_math_expression|expand_abbreviation)$/.test(l))return!0;var p=c.session.$mode,e=m.isSupportedMode(p);if(e&&p.$modes)try{T.setupContext(c),/js|php/.test(T.getSyntax())&&(e=!1)}catch(t){}return e};var L=function(c,l){var p=l;if(!!p){var e=m.isSupportedMode(p.session.$mode);c.enableEmmet===!1&&(e=!1),e&&m.load(),m.updateCommands(p,e)}};m.load=function(c){return typeof w!="string"?(y.warn("script for emmet-core is not loaded"),!1):(y.loadModule(w,function(){w=null,c&&c()}),!0)},m.AceEmmetEditor=R,y.defineOptions(H.prototype,"editor",{enableEmmet:{set:function(c){this[c?"on":"removeListener"]("changeMode",L),L({enableEmmet:!!c},this)},value:!0}}),m.setCore=function(c){typeof c=="string"?w=c:_=c}}),function(){ace.require(["ace/ext/emmet"],function(S){typeof module=="object"&&typeof exports=="object"&&module&&(module.exports=S)})}();
